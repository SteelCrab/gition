

<!DOCTYPE html>
<html class="writer-html5" lang="ko" data-content_root="../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>main &mdash; Gition Backend 0.1.0 문서</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=d6a8a7ef"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/translations.js?v=afa94a99"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="색인" href="../genindex.html" />
    <link rel="search" title="검색" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Gition Backend
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">목차:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">backend</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Gition Backend</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">모듈 코드</a></li>
      <li class="breadcrumb-item active">main</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>main의 소스 코드</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">==============================================================================</span>
<span class="sd">Gition Auth Server (FastAPI)</span>
<span class="sd">==============================================================================</span>

<span class="sd">FastAPI-based authentication and API proxy server for GitHub integration.</span>

<span class="sd">.. module:: main</span>
<span class="sd">   :synopsis: GitHub OAuth authentication and API proxy server</span>

<span class="sd">Main Features:</span>
<span class="sd">    - GitHub OAuth 2.0 authentication (login/logout)</span>
<span class="sd">    - Repository listing (public/private)</span>
<span class="sd">    - Git operations API (clone, pull, files, commits, branches)</span>
<span class="sd">    - GitHub Issues/PRs API proxy</span>

<span class="sd">Environment Variables:</span>
<span class="sd">    - ``GITHUB_CLIENT_ID``: GitHub OAuth app client ID</span>
<span class="sd">    - ``GITHUB_CLIENT_SECRET``: GitHub OAuth app client secret</span>
<span class="sd">    - ``REPOS_PATH``: Cloned repository storage path (default: /repos)</span>
<span class="sd">    - ``FRONTEND_URL``: Frontend URL for OAuth redirect (default: http://localhost)</span>
<span class="sd">    - ``ALLOWED_ORIGINS``: CORS allowed origins (comma-separated)</span>

<span class="sd">Example:</span>
<span class="sd">    Run the server with uvicorn::</span>

<span class="sd">        $ uvicorn main:app --host 0.0.0.0 --port 3001 --reload</span>

<span class="sd">==============================================================================</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">fastapi</span><span class="w"> </span><span class="kn">import</span> <span class="n">FastAPI</span><span class="p">,</span> <span class="n">Request</span><span class="p">,</span> <span class="n">Response</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">fastapi.responses</span><span class="w"> </span><span class="kn">import</span> <span class="n">RedirectResponse</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">fastapi.middleware.cors</span><span class="w"> </span><span class="kn">import</span> <span class="n">CORSMiddleware</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">httpx</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">urllib.parse</span><span class="w"> </span><span class="kn">import</span> <span class="n">urlencode</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dotenv</span><span class="w"> </span><span class="kn">import</span> <span class="n">load_dotenv</span>

<span class="c1"># Load environment variables from .env file</span>
<span class="n">load_dotenv</span><span class="p">()</span>

<span class="c1">#: FastAPI application instance</span>
<span class="c1">#:</span>
<span class="c1">#: :type: FastAPI</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">FastAPI</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Gition Auth Server&quot;</span><span class="p">)</span>

<span class="c1">#: List of allowed CORS origins, loaded from environment variable</span>
<span class="c1">#:</span>
<span class="c1">#: :type: list[str]</span>
<span class="n">ALLOWED_ORIGINS</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;ALLOWED_ORIGINS&quot;</span><span class="p">,</span> <span class="s2">&quot;http://localhost,http://localhost:80,http://localhost:5173&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>

<span class="n">app</span><span class="o">.</span><span class="n">add_middleware</span><span class="p">(</span>
    <span class="n">CORSMiddleware</span><span class="p">,</span>
    <span class="n">allow_origins</span><span class="o">=</span><span class="n">ALLOWED_ORIGINS</span><span class="p">,</span>
    <span class="n">allow_credentials</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">allow_methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;*&quot;</span><span class="p">],</span>
    <span class="n">allow_headers</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;*&quot;</span><span class="p">],</span>
<span class="p">)</span>

<span class="c1">#: GitHub OAuth application client ID</span>
<span class="c1">#:</span>
<span class="c1">#: :type: str | None</span>
<span class="n">GITHUB_CLIENT_ID</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;GITHUB_CLIENT_ID&quot;</span><span class="p">)</span>

<span class="c1">#: GitHub OAuth application client secret</span>
<span class="c1">#:</span>
<span class="c1">#: :type: str | None</span>
<span class="n">GITHUB_CLIENT_SECRET</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;GITHUB_CLIENT_SECRET&quot;</span><span class="p">)</span>

<span class="c1">#: Frontend URL for OAuth redirect after authentication</span>
<span class="c1">#:</span>
<span class="c1">#: :type: str</span>
<span class="n">FRONTEND_URL</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;FRONTEND_URL&quot;</span><span class="p">,</span> <span class="s2">&quot;http://localhost&quot;</span><span class="p">)</span>


<span class="c1"># ==============================================================================</span>
<span class="c1"># Health Check Endpoint</span>
<span class="c1"># ==============================================================================</span>

<div class="viewcode-block" id="health">
<a class="viewcode-back" href="../main.html#main.health">[문서]</a>
<span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/health&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">health</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check server status and configuration.</span>

<span class="sd">    Returns server health status and whether GitHub OAuth is properly configured.</span>

<span class="sd">    :returns: Health status response</span>
<span class="sd">    :rtype: dict</span>

<span class="sd">    :Example:</span>

<span class="sd">        &gt;&gt;&gt; response = await client.get(&quot;/health&quot;)</span>
<span class="sd">        &gt;&gt;&gt; response.json()</span>
<span class="sd">        {&quot;status&quot;: &quot;ok&quot;, &quot;github_configured&quot;: True}</span>

<span class="sd">    **Response Fields:**</span>

<span class="sd">    - ``status`` (str): Server status, always &quot;ok&quot; if server is running</span>
<span class="sd">    - ``github_configured`` (bool): Whether GitHub OAuth credentials are set</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;ok&quot;</span><span class="p">,</span>
        <span class="s2">&quot;github_configured&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">GITHUB_CLIENT_ID</span> <span class="ow">and</span> <span class="n">GITHUB_CLIENT_SECRET</span><span class="p">)</span>
    <span class="p">}</span></div>



<span class="c1"># ==============================================================================</span>
<span class="c1"># GitHub OAuth Authentication Flow</span>
<span class="c1"># ==============================================================================</span>

<div class="viewcode-block" id="github_auth">
<a class="viewcode-back" href="../main.html#main.github_auth">[문서]</a>
<span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/auth/github&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">github_auth</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initiate GitHub OAuth authentication flow.</span>

<span class="sd">    Redirects the user to GitHub&#39;s authorization page to grant access.</span>
<span class="sd">    After authorization, GitHub will redirect back to the callback endpoint.</span>

<span class="sd">    :returns: Redirect response to GitHub OAuth authorization page</span>
<span class="sd">    :rtype: RedirectResponse</span>

<span class="sd">    **OAuth Scopes Requested:**</span>

<span class="sd">    - ``read:user``: Read user profile information</span>
<span class="sd">    - ``user:email``: Read user email addresses</span>
<span class="sd">    - ``repo``: Full access to public and private repositories</span>

<span class="sd">    :Example:</span>

<span class="sd">        Navigate to ``/auth/github`` to start the OAuth flow.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Nginx proxies to port 80, so callback URL uses port 80</span>
    <span class="n">redirect_uri</span> <span class="o">=</span> <span class="s2">&quot;http://localhost/auth/github/callback&quot;</span>
    
    <span class="c1"># &#39;repo&#39; scope grants access to private repositories</span>
    <span class="n">scope</span> <span class="o">=</span> <span class="s2">&quot;read:user user:email repo&quot;</span>
    
    <span class="n">params</span> <span class="o">=</span> <span class="n">urlencode</span><span class="p">({</span>
        <span class="s2">&quot;client_id&quot;</span><span class="p">:</span> <span class="n">GITHUB_CLIENT_ID</span><span class="p">,</span>
        <span class="s2">&quot;redirect_uri&quot;</span><span class="p">:</span> <span class="n">redirect_uri</span><span class="p">,</span>
        <span class="s2">&quot;scope&quot;</span><span class="p">:</span> <span class="n">scope</span>
    <span class="p">})</span>
    
    <span class="k">return</span> <span class="n">RedirectResponse</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;https://github.com/login/oauth/authorize?</span><span class="si">{</span><span class="n">params</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="github_callback">
<a class="viewcode-back" href="../main.html#main.github_callback">[문서]</a>
<span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/auth/github/callback&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">github_callback</span><span class="p">(</span><span class="n">code</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">error</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Handle GitHub OAuth callback after user authorization.</span>

<span class="sd">    This endpoint is called by GitHub after the user grants/denies access.</span>
<span class="sd">    It exchanges the authorization code for an access token, fetches user info,</span>
<span class="sd">    and redirects to the frontend with user data.</span>

<span class="sd">    :param code: Authorization code from GitHub (on success)</span>
<span class="sd">    :type code: str | None</span>
<span class="sd">    :param error: Error message from GitHub (on failure)</span>
<span class="sd">    :type error: str | None</span>

<span class="sd">    :returns: Redirect to frontend with user info or error</span>
<span class="sd">    :rtype: RedirectResponse</span>

<span class="sd">    **Authentication Flow:**</span>

<span class="sd">    1. Receive authorization code from GitHub</span>
<span class="sd">    2. Exchange code for access token via POST request</span>
<span class="sd">    3. Fetch user profile and email with access token</span>
<span class="sd">    4. Set secure HttpOnly cookie with access token</span>
<span class="sd">    5. Redirect to frontend with user info in URL params</span>

<span class="sd">    **Cookie Settings:**</span>

<span class="sd">    - ``github_token``: Access token stored as HttpOnly cookie</span>
<span class="sd">    - Max age: 7 days</span>
<span class="sd">    - SameSite: Lax</span>
<span class="sd">    - Secure: Based on FRONTEND_URL protocol</span>

<span class="sd">    :raises: Redirects to ``/login?error=auth_failed`` on failure</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Error handling</span>
    <span class="k">if</span> <span class="n">error</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">code</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">RedirectResponse</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">FRONTEND_URL</span><span class="si">}</span><span class="s2">/login?error=auth_failed&quot;</span><span class="p">)</span>
    
    <span class="k">async</span> <span class="k">with</span> <span class="n">httpx</span><span class="o">.</span><span class="n">AsyncClient</span><span class="p">()</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
        <span class="c1"># Step 1: Exchange authorization code for access token</span>
        <span class="n">token_response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="s2">&quot;https://github.com/login/oauth/access_token&quot;</span><span class="p">,</span>
            <span class="n">json</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;client_id&quot;</span><span class="p">:</span> <span class="n">GITHUB_CLIENT_ID</span><span class="p">,</span>
                <span class="s2">&quot;client_secret&quot;</span><span class="p">:</span> <span class="n">GITHUB_CLIENT_SECRET</span><span class="p">,</span>
                <span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="n">code</span>
            <span class="p">},</span>
            <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Accept&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">}</span>
        <span class="p">)</span>
        
        <span class="n">token_data</span> <span class="o">=</span> <span class="n">token_response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="s2">&quot;error&quot;</span> <span class="ow">in</span> <span class="n">token_data</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">RedirectResponse</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">FRONTEND_URL</span><span class="si">}</span><span class="s2">/login?error=token_error&quot;</span><span class="p">)</span>
        
        <span class="n">access_token</span> <span class="o">=</span> <span class="n">token_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;access_token&quot;</span><span class="p">)</span>
        
        <span class="c1"># Step 2: Fetch user info</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Bearer </span><span class="si">{</span><span class="n">access_token</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Accept&quot;</span><span class="p">:</span> <span class="s2">&quot;application/vnd.github.v3+json&quot;</span>
        <span class="p">}</span>
        
        <span class="n">user_response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://api.github.com/user&quot;</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
        <span class="n">user_data</span> <span class="o">=</span> <span class="n">user_response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        
        <span class="c1"># Step 3: Fetch user email (prefer primary email)</span>
        <span class="n">email_response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://api.github.com/user/emails&quot;</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
        <span class="n">emails</span> <span class="o">=</span> <span class="n">email_response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="n">primary_email</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span>
            <span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s2">&quot;email&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">emails</span> <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;primary&quot;</span><span class="p">)),</span>
            <span class="n">emails</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;email&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">emails</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="p">)</span>
        
        <span class="c1"># Step 4: Prepare user info for frontend</span>
        <span class="n">user_info</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">user_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">),</span>
            <span class="s2">&quot;login&quot;</span><span class="p">:</span> <span class="n">user_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;login&quot;</span><span class="p">),</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">user_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">user_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;login&quot;</span><span class="p">),</span>
            <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="n">primary_email</span> <span class="ow">or</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">user_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">+</span><span class="si">{</span><span class="n">user_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">@users.noreply.github.com&quot;</span><span class="p">,</span>
            <span class="s2">&quot;avatar_url&quot;</span><span class="p">:</span> <span class="n">user_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;avatar_url&quot;</span><span class="p">)</span>
        <span class="p">}</span>
        
        <span class="c1"># Security: Use Secure, HttpOnly cookie instead of URL parameters</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">RedirectResponse</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">FRONTEND_URL</span><span class="si">}</span><span class="s2">/auth/callback?user=</span><span class="si">{</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">user_info</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="c1"># Determine if we are on HTTPS (for Secure attribute)</span>
        <span class="n">is_https</span> <span class="o">=</span> <span class="n">FRONTEND_URL</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;https&quot;</span><span class="p">)</span>
        
        <span class="n">response</span><span class="o">.</span><span class="n">set_cookie</span><span class="p">(</span>
            <span class="n">key</span><span class="o">=</span><span class="s2">&quot;github_token&quot;</span><span class="p">,</span>
            <span class="n">value</span><span class="o">=</span><span class="n">access_token</span><span class="p">,</span>
            <span class="n">httponly</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">secure</span><span class="o">=</span><span class="n">is_https</span><span class="p">,</span>
            <span class="n">samesite</span><span class="o">=</span><span class="s2">&quot;lax&quot;</span><span class="p">,</span>
            <span class="n">max_age</span><span class="o">=</span><span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">7</span><span class="p">,</span>  <span class="c1"># 7 days</span>
            <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/&quot;</span>
        <span class="p">)</span>
        
        <span class="k">return</span> <span class="n">response</span></div>



<span class="c1"># ==============================================================================</span>
<span class="c1"># Repository List API</span>
<span class="c1"># ==============================================================================</span>

<div class="viewcode-block" id="get_token">
<a class="viewcode-back" href="../main.html#main.get_token">[문서]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_token</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extract GitHub access token from request.</span>

<span class="sd">    Checks for token in Authorization header first, then falls back to cookie.</span>

<span class="sd">    :param request: FastAPI request object</span>
<span class="sd">    :type request: Request</span>

<span class="sd">    :returns: Access token if found, None otherwise</span>
<span class="sd">    :rtype: str | None</span>

<span class="sd">    **Token Sources (in order of precedence):**</span>

<span class="sd">    1. ``Authorization`` header: ``Bearer &lt;token&gt;``</span>
<span class="sd">    2. ``github_token`` cookie (set during OAuth callback)</span>

<span class="sd">    :Example:</span>

<span class="sd">        &gt;&gt;&gt; token = get_token(request)</span>
<span class="sd">        &gt;&gt;&gt; if token:</span>
<span class="sd">        ...     # Use token for GitHub API calls</span>
<span class="sd">        ...     pass</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">auth</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Authorization&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">auth</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">auth</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;Bearer &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">auth</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Bearer &quot;</span><span class="p">)</span> <span class="k">else</span> <span class="n">auth</span>
    <span class="k">return</span> <span class="n">request</span><span class="o">.</span><span class="n">cookies</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;github_token&quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="get_repos">
<a class="viewcode-back" href="../main.html#main.get_repos">[문서]</a>
<span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/api/repos&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_repos</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    List all repositories accessible by the authenticated user.</span>

<span class="sd">    Fetches repositories from GitHub API including public, private,</span>
<span class="sd">    owned, and collaborated repositories.</span>

<span class="sd">    :param request: FastAPI request object (contains auth token)</span>
<span class="sd">    :type request: Request</span>

<span class="sd">    :returns: Repository list response</span>
<span class="sd">    :rtype: dict</span>

<span class="sd">    **Response Fields:**</span>

<span class="sd">    - ``total`` (int): Total repository count</span>
<span class="sd">    - ``public`` (int): Public repository count</span>
<span class="sd">    - ``private`` (int): Private repository count</span>
<span class="sd">    - ``repos`` (list): List of repository objects</span>

<span class="sd">    **Repository Object Fields:**</span>

<span class="sd">    - ``id`` (int): Repository ID</span>
<span class="sd">    - ``name`` (str): Repository name</span>
<span class="sd">    - ``full_name`` (str): Full repository name (owner/repo)</span>
<span class="sd">    - ``description`` (str | None): Repository description</span>
<span class="sd">    - ``private`` (bool): Whether repository is private</span>
<span class="sd">    - ``html_url`` (str): GitHub web URL</span>
<span class="sd">    - ``clone_url`` (str): HTTPS clone URL</span>
<span class="sd">    - ``ssh_url`` (str): SSH clone URL</span>
<span class="sd">    - ``language`` (str | None): Primary programming language</span>
<span class="sd">    - ``stargazers_count`` (int): Star count</span>
<span class="sd">    - ``updated_at`` (str): Last update timestamp (ISO 8601)</span>
<span class="sd">    - ``default_branch`` (str): Default branch name</span>

<span class="sd">    :raises: Returns ``{&quot;error&quot;: &quot;Not authenticated&quot;, &quot;repos&quot;: []}`` if no token</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">token</span> <span class="o">=</span> <span class="n">get_token</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">token</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Not authenticated&quot;</span><span class="p">,</span> <span class="s2">&quot;repos&quot;</span><span class="p">:</span> <span class="p">[]}</span>
    
    <span class="k">async</span> <span class="k">with</span> <span class="n">httpx</span><span class="o">.</span><span class="n">AsyncClient</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mf">10.0</span><span class="p">)</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Bearer </span><span class="si">{</span><span class="n">token</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Accept&quot;</span><span class="p">:</span> <span class="s2">&quot;application/vnd.github.v3+json&quot;</span>
        <span class="p">}</span>
        
        <span class="n">repos_response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s2">&quot;https://api.github.com/user/repos&quot;</span><span class="p">,</span>
            <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span>
            <span class="n">params</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;visibility&quot;</span><span class="p">:</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span>                                  <span class="c1"># Public + private</span>
                <span class="s2">&quot;affiliation&quot;</span><span class="p">:</span> <span class="s2">&quot;owner,collaborator,organization_member&quot;</span><span class="p">,</span>
                <span class="s2">&quot;sort&quot;</span><span class="p">:</span> <span class="s2">&quot;updated&quot;</span><span class="p">,</span>                                    <span class="c1"># Most recently updated first</span>
                <span class="s2">&quot;per_page&quot;</span><span class="p">:</span> <span class="mi">100</span>
            <span class="p">}</span>
        <span class="p">)</span>
        
        <span class="k">if</span> <span class="n">repos_response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Failed to fetch repos&quot;</span><span class="p">,</span> <span class="s2">&quot;repos&quot;</span><span class="p">:</span> <span class="p">[]}</span>
        
        <span class="n">repos_data</span> <span class="o">=</span> <span class="n">repos_response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        
        <span class="c1"># Extract necessary fields for response</span>
        <span class="n">repos</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">repo</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">repo</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
                <span class="s2">&quot;full_name&quot;</span><span class="p">:</span> <span class="n">repo</span><span class="p">[</span><span class="s2">&quot;full_name&quot;</span><span class="p">],</span>
                <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="n">repo</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">],</span>
                <span class="s2">&quot;private&quot;</span><span class="p">:</span> <span class="n">repo</span><span class="p">[</span><span class="s2">&quot;private&quot;</span><span class="p">],</span>
                <span class="s2">&quot;html_url&quot;</span><span class="p">:</span> <span class="n">repo</span><span class="p">[</span><span class="s2">&quot;html_url&quot;</span><span class="p">],</span>
                <span class="s2">&quot;clone_url&quot;</span><span class="p">:</span> <span class="n">repo</span><span class="p">[</span><span class="s2">&quot;clone_url&quot;</span><span class="p">],</span>
                <span class="s2">&quot;ssh_url&quot;</span><span class="p">:</span> <span class="n">repo</span><span class="p">[</span><span class="s2">&quot;ssh_url&quot;</span><span class="p">],</span>
                <span class="s2">&quot;language&quot;</span><span class="p">:</span> <span class="n">repo</span><span class="p">[</span><span class="s2">&quot;language&quot;</span><span class="p">],</span>
                <span class="s2">&quot;stargazers_count&quot;</span><span class="p">:</span> <span class="n">repo</span><span class="p">[</span><span class="s2">&quot;stargazers_count&quot;</span><span class="p">],</span>
                <span class="s2">&quot;updated_at&quot;</span><span class="p">:</span> <span class="n">repo</span><span class="p">[</span><span class="s2">&quot;updated_at&quot;</span><span class="p">],</span>
                <span class="s2">&quot;default_branch&quot;</span><span class="p">:</span> <span class="n">repo</span><span class="p">[</span><span class="s2">&quot;default_branch&quot;</span><span class="p">]</span>
            <span class="p">}</span>
            <span class="k">for</span> <span class="n">repo</span> <span class="ow">in</span> <span class="n">repos_data</span>
        <span class="p">]</span>
        
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;total&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">repos</span><span class="p">),</span>
            <span class="s2">&quot;public&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">([</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">repos</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">r</span><span class="p">[</span><span class="s2">&quot;private&quot;</span><span class="p">]]),</span>
            <span class="s2">&quot;private&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">([</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">repos</span> <span class="k">if</span> <span class="n">r</span><span class="p">[</span><span class="s2">&quot;private&quot;</span><span class="p">]]),</span>
            <span class="s2">&quot;repos&quot;</span><span class="p">:</span> <span class="n">repos</span>
        <span class="p">}</span></div>



<span class="c1"># ==============================================================================</span>
<span class="c1"># Git Operations API</span>
<span class="c1"># ==============================================================================</span>
<span class="c1"># Import actual Git operation functions from git_ops.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">git_ops</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">clone_repo</span><span class="p">,</span> <span class="n">pull_repo</span><span class="p">,</span> <span class="n">list_files</span><span class="p">,</span> <span class="n">read_file</span><span class="p">,</span>
    <span class="n">is_cloned</span><span class="p">,</span> <span class="n">delete_repo</span><span class="p">,</span> <span class="n">search_files</span><span class="p">,</span> <span class="n">get_commits</span><span class="p">,</span>
    <span class="n">get_branches</span><span class="p">,</span> <span class="n">checkout_branch</span>
<span class="p">)</span>


<div class="viewcode-block" id="api_clone_repo">
<a class="viewcode-back" href="../main.html#main.api_clone_repo">[문서]</a>
<span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/api/git/clone&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">api_clone_repo</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Clone a GitHub repository to local server storage.</span>

<span class="sd">    Clones a repository using HTTPS with token authentication.</span>
<span class="sd">    Repositories are stored at ``/repos/{user_id}/{repo_name}/``.</span>

<span class="sd">    :param request: FastAPI request object containing JSON body</span>
<span class="sd">    :type request: Request</span>

<span class="sd">    :returns: Clone operation result</span>
<span class="sd">    :rtype: dict</span>

<span class="sd">    **Request Body (JSON):**</span>

<span class="sd">    - ``clone_url`` (str): Repository HTTPS clone URL</span>
<span class="sd">    - ``access_token`` (str): GitHub access token for authentication</span>
<span class="sd">    - ``user_id`` (str): User&#39;s GitHub ID (for path separation)</span>
<span class="sd">    - ``repo_name`` (str): Repository name</span>

<span class="sd">    **Response Fields:**</span>

<span class="sd">    - ``status`` (str): &quot;success&quot; | &quot;exists&quot; | &quot;error&quot;</span>
<span class="sd">    - ``path`` (str | None): Local path where repo is cloned</span>
<span class="sd">    - ``message`` (str): Status message</span>

<span class="sd">    :Example:</span>

<span class="sd">        &gt;&gt;&gt; response = await client.post(&quot;/api/git/clone&quot;, json={</span>
<span class="sd">        ...     &quot;clone_url&quot;: &quot;https://github.com/user/repo.git&quot;,</span>
<span class="sd">        ...     &quot;access_token&quot;: &quot;ghp_xxx&quot;,</span>
<span class="sd">        ...     &quot;user_id&quot;: &quot;12345&quot;,</span>
<span class="sd">        ...     &quot;repo_name&quot;: &quot;my-repo&quot;</span>
<span class="sd">        ... })</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">body</span> <span class="o">=</span> <span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="n">clone_url</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;clone_url&quot;</span><span class="p">)</span>
        <span class="n">access_token</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;access_token&quot;</span><span class="p">)</span>
        <span class="n">user_id</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;user_id&quot;</span><span class="p">)</span>
        <span class="n">repo_name</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;repo_name&quot;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="n">clone_url</span><span class="p">,</span> <span class="n">access_token</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">repo_name</span><span class="p">]):</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Missing required fields&quot;</span><span class="p">}</span>
        
        <span class="c1"># Performance: Use to_thread for blocking Git operations</span>
        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">to_thread</span><span class="p">(</span><span class="n">clone_repo</span><span class="p">,</span> <span class="n">clone_url</span><span class="p">,</span> <span class="n">access_token</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">user_id</span><span class="p">),</span> <span class="n">repo_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span></div>



<div class="viewcode-block" id="api_pull_repo">
<a class="viewcode-back" href="../main.html#main.api_pull_repo">[문서]</a>
<span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/api/git/pull&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">api_pull_repo</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Pull latest changes from remote for a cloned repository.</span>

<span class="sd">    Fetches and merges changes from the origin remote.</span>

<span class="sd">    :param request: FastAPI request object containing JSON body</span>
<span class="sd">    :type request: Request</span>

<span class="sd">    :returns: Pull operation result</span>
<span class="sd">    :rtype: dict</span>

<span class="sd">    **Request Body (JSON):**</span>

<span class="sd">    - ``user_id`` (str): User&#39;s GitHub ID</span>
<span class="sd">    - ``repo_name`` (str): Repository name</span>

<span class="sd">    **Response Fields:**</span>

<span class="sd">    - ``status`` (str): &quot;success&quot; | &quot;error&quot;</span>
<span class="sd">    - ``message`` (str): Result message</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">body</span> <span class="o">=</span> <span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="n">user_id</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;user_id&quot;</span><span class="p">)</span>
        <span class="n">repo_name</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;repo_name&quot;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="n">user_id</span><span class="p">,</span> <span class="n">repo_name</span><span class="p">]):</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Missing required fields&quot;</span><span class="p">}</span>
        
        <span class="c1"># Performance: Use to_thread for blocking Git operations</span>
        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">to_thread</span><span class="p">(</span><span class="n">pull_repo</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">user_id</span><span class="p">),</span> <span class="n">repo_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span></div>



<div class="viewcode-block" id="api_list_files">
<a class="viewcode-back" href="../main.html#main.api_list_files">[문서]</a>
<span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/api/git/files&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">api_list_files</span><span class="p">(</span><span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">repo_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    List files and directories in a cloned repository.</span>

<span class="sd">    Returns directory contents with file metadata.</span>
<span class="sd">    Directories are sorted before files, alphabetically.</span>

<span class="sd">    :param user_id: User&#39;s GitHub ID</span>
<span class="sd">    :type user_id: str</span>
<span class="sd">    :param repo_name: Repository name</span>
<span class="sd">    :type repo_name: str</span>
<span class="sd">    :param path: Subdirectory path (empty string for root)</span>
<span class="sd">    :type path: str</span>

<span class="sd">    :returns: File listing result</span>
<span class="sd">    :rtype: dict</span>

<span class="sd">    **Response Fields:**</span>

<span class="sd">    - ``status`` (str): &quot;success&quot; | &quot;error&quot;</span>
<span class="sd">    - ``path`` (str): Requested path</span>
<span class="sd">    - ``files`` (list): List of file/directory objects</span>

<span class="sd">    **File Object Fields:**</span>

<span class="sd">    - ``name`` (str): File or directory name</span>
<span class="sd">    - ``type`` (str): &quot;file&quot; | &quot;directory&quot;</span>
<span class="sd">    - ``size`` (int | None): File size in bytes (None for directories)</span>
<span class="sd">    - ``path`` (str): Relative path from repository root</span>

<span class="sd">    .. note::</span>
<span class="sd">        The ``.git`` directory is excluded from listings.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Performance: Use to_thread for blocking Git operations</span>
    <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">to_thread</span><span class="p">(</span><span class="n">list_files</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">repo_name</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span></div>



<div class="viewcode-block" id="api_read_file">
<a class="viewcode-back" href="../main.html#main.api_read_file">[문서]</a>
<span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/api/git/file&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">api_read_file</span><span class="p">(</span><span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">repo_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read file content from a cloned repository.</span>

<span class="sd">    Returns file content for text files. Binary files return</span>
<span class="sd">    metadata only with content set to None.</span>

<span class="sd">    :param user_id: User&#39;s GitHub ID</span>
<span class="sd">    :type user_id: str</span>
<span class="sd">    :param repo_name: Repository name</span>
<span class="sd">    :type repo_name: str</span>
<span class="sd">    :param path: File path relative to repository root</span>
<span class="sd">    :type path: str</span>

<span class="sd">    :returns: File content result</span>
<span class="sd">    :rtype: dict</span>

<span class="sd">    **Response Fields:**</span>

<span class="sd">    - ``status`` (str): &quot;success&quot; | &quot;error&quot;</span>
<span class="sd">    - ``path`` (str): File path</span>
<span class="sd">    - ``binary`` (bool): Whether file is binary</span>
<span class="sd">    - ``size`` (int): File size in bytes</span>
<span class="sd">    - ``content`` (str | None): File content (None for binary files)</span>

<span class="sd">    **Binary Detection:**</span>

<span class="sd">    Files with extensions like .png, .jpg, .pdf, .exe are</span>
<span class="sd">    treated as binary and content is not returned.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Performance: Use to_thread for blocking Git operations</span>
    <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">to_thread</span><span class="p">(</span><span class="n">read_file</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">repo_name</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span></div>



<div class="viewcode-block" id="api_repo_status">
<a class="viewcode-back" href="../main.html#main.api_repo_status">[문서]</a>
<span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/api/git/status&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">api_repo_status</span><span class="p">(</span><span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">repo_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if a repository is cloned locally.</span>

<span class="sd">    :param user_id: User&#39;s GitHub ID</span>
<span class="sd">    :type user_id: str</span>
<span class="sd">    :param repo_name: Repository name</span>
<span class="sd">    :type repo_name: str</span>

<span class="sd">    :returns: Clone status</span>
<span class="sd">    :rtype: dict</span>

<span class="sd">    **Response Fields:**</span>

<span class="sd">    - ``cloned`` (bool): Whether repository exists locally with .git folder</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cloned</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">to_thread</span><span class="p">(</span><span class="n">is_cloned</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">repo_name</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;cloned&quot;</span><span class="p">:</span> <span class="n">cloned</span>
    <span class="p">}</span></div>



<div class="viewcode-block" id="api_delete_repo">
<a class="viewcode-back" href="../main.html#main.api_delete_repo">[문서]</a>
<span class="nd">@app</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s2">&quot;/api/git/repo&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">api_delete_repo</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Delete a cloned repository from local storage.</span>

<span class="sd">    Removes the entire repository directory including all files.</span>

<span class="sd">    :param request: FastAPI request object containing JSON body</span>
<span class="sd">    :type request: Request</span>

<span class="sd">    :returns: Delete operation result</span>
<span class="sd">    :rtype: dict</span>

<span class="sd">    **Request Body (JSON):**</span>

<span class="sd">    - ``user_id`` (str): User&#39;s GitHub ID</span>
<span class="sd">    - ``repo_name`` (str): Repository name</span>

<span class="sd">    **Response Fields:**</span>

<span class="sd">    - ``status`` (str): &quot;success&quot; | &quot;error&quot;</span>
<span class="sd">    - ``message`` (str): Result message</span>

<span class="sd">    .. warning::</span>
<span class="sd">        This operation is irreversible. All local changes will be lost.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">body</span> <span class="o">=</span> <span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="n">user_id</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;user_id&quot;</span><span class="p">)</span>
        <span class="n">repo_name</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;repo_name&quot;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="n">user_id</span><span class="p">,</span> <span class="n">repo_name</span><span class="p">]):</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Missing required fields&quot;</span><span class="p">}</span>
        
        <span class="c1"># Performance: Use to_thread for blocking Git operations</span>
        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">to_thread</span><span class="p">(</span><span class="n">delete_repo</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">user_id</span><span class="p">),</span> <span class="n">repo_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span></div>



<div class="viewcode-block" id="api_search_files">
<a class="viewcode-back" href="../main.html#main.api_search_files">[문서]</a>
<span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/api/git/search&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">api_search_files</span><span class="p">(</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">repo_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">content</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">max_results</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Search files and content within a repository.</span>

<span class="sd">    Searches both filenames and file content (optionally).</span>
<span class="sd">    Binary files are skipped for content search.</span>

<span class="sd">    :param user_id: User&#39;s GitHub ID</span>
<span class="sd">    :type user_id: str</span>
<span class="sd">    :param repo_name: Repository name</span>
<span class="sd">    :type repo_name: str</span>
<span class="sd">    :param query: Search query (minimum 2 characters)</span>
<span class="sd">    :type query: str</span>
<span class="sd">    :param content: Whether to search file content (default: True)</span>
<span class="sd">    :type content: bool</span>
<span class="sd">    :param max_results: Maximum result count (max: 100)</span>
<span class="sd">    :type max_results: int</span>

<span class="sd">    :returns: Search results</span>
<span class="sd">    :rtype: dict</span>

<span class="sd">    **Response Fields:**</span>

<span class="sd">    - ``status`` (str): &quot;success&quot; | &quot;error&quot;</span>
<span class="sd">    - ``query`` (str): Original search query</span>
<span class="sd">    - ``total`` (int): Total result count</span>
<span class="sd">    - ``results`` (list): List of search result objects</span>

<span class="sd">    **Result Object Fields:**</span>

<span class="sd">    - ``type`` (str): &quot;filename&quot; | &quot;content&quot;</span>
<span class="sd">    - ``path`` (str): File path relative to repo root</span>
<span class="sd">    - ``name`` (str): File name</span>
<span class="sd">    - ``match`` (str): Matched text</span>
<span class="sd">    - ``line`` (int | None): Line number (for content matches)</span>
<span class="sd">    - ``context`` (str | None): Context around match (for content matches)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">query</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">query</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Query must be at least 2 characters&quot;</span><span class="p">,</span> <span class="s2">&quot;results&quot;</span><span class="p">:</span> <span class="p">[]}</span>
    
    <span class="c1"># Performance: Use to_thread for blocking Git operations</span>
    <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">to_thread</span><span class="p">(</span><span class="n">search_files</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">repo_name</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">max_results</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">result</span></div>



<div class="viewcode-block" id="api_get_commits">
<a class="viewcode-back" href="../main.html#main.api_get_commits">[문서]</a>
<span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/api/git/commits&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">api_get_commits</span><span class="p">(</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">repo_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">max_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get commit history for a repository.</span>

<span class="sd">    Returns a list of commits with author, message, and stats.</span>

<span class="sd">    :param user_id: User&#39;s GitHub ID</span>
<span class="sd">    :type user_id: str</span>
<span class="sd">    :param repo_name: Repository name</span>
<span class="sd">    :type repo_name: str</span>
<span class="sd">    :param max_count: Maximum commit count (max: 100, default: 50)</span>
<span class="sd">    :type max_count: int</span>

<span class="sd">    :returns: Commit history</span>
<span class="sd">    :rtype: dict</span>

<span class="sd">    **Response Fields:**</span>

<span class="sd">    - ``status`` (str): &quot;success&quot; | &quot;error&quot;</span>
<span class="sd">    - ``total`` (int): Number of commits returned</span>
<span class="sd">    - ``commits`` (list): List of commit objects</span>

<span class="sd">    **Commit Object Fields:**</span>

<span class="sd">    - ``sha`` (str): Abbreviated commit SHA (7 characters)</span>
<span class="sd">    - ``full_sha`` (str): Full commit SHA</span>
<span class="sd">    - ``message`` (str): First line of commit message</span>
<span class="sd">    - ``author`` (str): Author name</span>
<span class="sd">    - ``author_email`` (str): Author email</span>
<span class="sd">    - ``date`` (str): Commit date (ISO 8601)</span>
<span class="sd">    - ``stats`` (dict): Commit statistics (files, insertions, deletions)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Performance: Use to_thread for blocking Git operations</span>
    <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">to_thread</span><span class="p">(</span><span class="n">get_commits</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">repo_name</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">max_count</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">result</span></div>



<div class="viewcode-block" id="api_get_branches">
<a class="viewcode-back" href="../main.html#main.api_get_branches">[문서]</a>
<span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/api/git/branches&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">api_get_branches</span><span class="p">(</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">repo_name</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get branch list for a repository.</span>

<span class="sd">    Returns both local and remote branches with current branch indicator.</span>
<span class="sd">    Performs a git fetch first to ensure remote branches are up to date.</span>

<span class="sd">    :param user_id: User&#39;s GitHub ID</span>
<span class="sd">    :type user_id: str</span>
<span class="sd">    :param repo_name: Repository name</span>
<span class="sd">    :type repo_name: str</span>

<span class="sd">    :returns: Branch list</span>
<span class="sd">    :rtype: dict</span>

<span class="sd">    **Response Fields:**</span>

<span class="sd">    - ``status`` (str): &quot;success&quot; | &quot;error&quot;</span>
<span class="sd">    - ``current_branch`` (str | None): Currently checked out branch</span>
<span class="sd">    - ``total`` (int): Total branch count</span>
<span class="sd">    - ``branches`` (list): List of branch objects</span>

<span class="sd">    **Branch Object Fields:**</span>

<span class="sd">    - ``name`` (str): Branch name</span>
<span class="sd">    - ``type`` (str): &quot;local&quot; | &quot;remote&quot;</span>
<span class="sd">    - ``is_current`` (bool): Whether this is the current branch</span>
<span class="sd">    - ``commit_sha`` (str): Latest commit SHA (7 characters)</span>
<span class="sd">    - ``commit_message`` (str): Latest commit message (first line)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Performance: Use to_thread for blocking Git operations</span>
    <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">to_thread</span><span class="p">(</span><span class="n">get_branches</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">repo_name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span></div>



<div class="viewcode-block" id="api_checkout_branch">
<a class="viewcode-back" href="../main.html#main.api_checkout_branch">[문서]</a>
<span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/api/git/checkout&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">api_checkout_branch</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Checkout (switch to) a branch.</span>

<span class="sd">    Switches the working directory to the specified branch.</span>
<span class="sd">    If the branch only exists on remote, creates a local tracking branch.</span>

<span class="sd">    :param request: FastAPI request object containing JSON body</span>
<span class="sd">    :type request: Request</span>

<span class="sd">    :returns: Checkout result</span>
<span class="sd">    :rtype: dict</span>

<span class="sd">    **Request Body (JSON):**</span>

<span class="sd">    - ``user_id`` (str): User&#39;s GitHub ID</span>
<span class="sd">    - ``repo_name`` (str): Repository name</span>
<span class="sd">    - ``branch_name`` (str): Branch name to checkout</span>

<span class="sd">    **Response Fields:**</span>

<span class="sd">    - ``status`` (str): &quot;success&quot; | &quot;error&quot;</span>
<span class="sd">    - ``message`` (str): Result message</span>
<span class="sd">    - ``current_branch`` (str): Current branch after checkout</span>

<span class="sd">    **Checkout Behavior:**</span>

<span class="sd">    1. If local branch exists, checkout directly</span>
<span class="sd">    2. If only remote exists, create local branch tracking origin/{branch}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">body</span> <span class="o">=</span> <span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="n">user_id</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;user_id&quot;</span><span class="p">)</span>
        <span class="n">repo_name</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;repo_name&quot;</span><span class="p">)</span>
        <span class="n">branch_name</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;branch_name&quot;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="n">user_id</span><span class="p">,</span> <span class="n">repo_name</span><span class="p">,</span> <span class="n">branch_name</span><span class="p">]):</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Missing required fields&quot;</span><span class="p">}</span>
        
        <span class="c1"># Performance: Use to_thread for blocking Git operations</span>
        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">to_thread</span><span class="p">(</span><span class="n">checkout_branch</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">repo_name</span><span class="p">,</span> <span class="n">branch_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span></div>



<span class="c1"># ==============================================================================</span>
<span class="c1"># GitHub Issues &amp; PRs API (Proxy)</span>
<span class="c1"># ==============================================================================</span>
<span class="c1"># Fetch Issues/PRs info by directly calling GitHub API</span>
<span class="c1"># Works without cloning the repository</span>

<div class="viewcode-block" id="api_get_issues">
<a class="viewcode-back" href="../main.html#main.api_get_issues">[문서]</a>
<span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/api/github/issues&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">api_get_issues</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span> <span class="n">owner</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">repo</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;open&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get issues for a GitHub repository.</span>

<span class="sd">    Fetches issues directly from GitHub API (no clone required).</span>
<span class="sd">    Pull Requests are filtered out (they appear in issues endpoint).</span>

<span class="sd">    :param request: FastAPI request object (contains auth token)</span>
<span class="sd">    :type request: Request</span>
<span class="sd">    :param owner: Repository owner (username or organization)</span>
<span class="sd">    :type owner: str</span>
<span class="sd">    :param repo: Repository name</span>
<span class="sd">    :type repo: str</span>
<span class="sd">    :param state: Issue state filter (&quot;open&quot;, &quot;closed&quot;, &quot;all&quot;)</span>
<span class="sd">    :type state: str</span>

<span class="sd">    :returns: Issues list</span>
<span class="sd">    :rtype: dict</span>

<span class="sd">    **Response Fields:**</span>

<span class="sd">    - ``status`` (str): &quot;success&quot; | &quot;error&quot;</span>
<span class="sd">    - ``total`` (int): Number of issues returned</span>
<span class="sd">    - ``issues`` (list): List of issue objects</span>

<span class="sd">    **Issue Object Fields:**</span>

<span class="sd">    - ``id`` (int): Issue ID</span>
<span class="sd">    - ``number`` (int): Issue number</span>
<span class="sd">    - ``title`` (str): Issue title</span>
<span class="sd">    - ``state`` (str): Issue state (&quot;open&quot; | &quot;closed&quot;)</span>
<span class="sd">    - ``user`` (dict): Author info (login, avatar_url)</span>
<span class="sd">    - ``labels`` (list): List of label objects (name, color)</span>
<span class="sd">    - ``comments`` (int): Comment count</span>
<span class="sd">    - ``created_at`` (str): Creation timestamp (ISO 8601)</span>
<span class="sd">    - ``updated_at`` (str): Last update timestamp (ISO 8601)</span>
<span class="sd">    - ``html_url`` (str): GitHub web URL</span>

<span class="sd">    .. note::</span>
<span class="sd">        Requires Authorization header with valid GitHub token.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">token</span> <span class="o">=</span> <span class="n">get_token</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">token</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;No authorization token&quot;</span><span class="p">,</span> <span class="s2">&quot;issues&quot;</span><span class="p">:</span> <span class="p">[]}</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="k">async</span> <span class="k">with</span> <span class="n">httpx</span><span class="o">.</span><span class="n">AsyncClient</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mf">10.0</span><span class="p">)</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;https://api.github.com/repos/</span><span class="si">{</span><span class="n">owner</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">repo</span><span class="si">}</span><span class="s2">/issues&quot;</span><span class="p">,</span>
                <span class="n">headers</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Bearer </span><span class="si">{</span><span class="n">token</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Accept&quot;</span><span class="p">:</span> <span class="s2">&quot;application/vnd.github.v3+json&quot;</span>
                <span class="p">},</span>
                <span class="n">params</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;state&quot;</span><span class="p">:</span> <span class="n">state</span><span class="p">,</span>
                    <span class="s2">&quot;per_page&quot;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
                    <span class="s2">&quot;sort&quot;</span><span class="p">:</span> <span class="s2">&quot;updated&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;direction&quot;</span><span class="p">:</span> <span class="s2">&quot;desc&quot;</span>
                <span class="p">}</span>
            <span class="p">)</span>
        
        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Failed to fetch issues&quot;</span><span class="p">,</span> <span class="s2">&quot;issues&quot;</span><span class="p">:</span> <span class="p">[]}</span>
        
        <span class="n">issues_data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        
        <span class="c1"># Filter out PRs (they appear in issues endpoint too)</span>
        <span class="n">issues</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">issue</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span>
                <span class="s2">&quot;number&quot;</span><span class="p">:</span> <span class="n">issue</span><span class="p">[</span><span class="s2">&quot;number&quot;</span><span class="p">],</span>
                <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="n">issue</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">],</span>
                <span class="s2">&quot;state&quot;</span><span class="p">:</span> <span class="n">issue</span><span class="p">[</span><span class="s2">&quot;state&quot;</span><span class="p">],</span>
                <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;login&quot;</span><span class="p">:</span> <span class="n">issue</span><span class="p">[</span><span class="s2">&quot;user&quot;</span><span class="p">][</span><span class="s2">&quot;login&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;avatar_url&quot;</span><span class="p">:</span> <span class="n">issue</span><span class="p">[</span><span class="s2">&quot;user&quot;</span><span class="p">][</span><span class="s2">&quot;avatar_url&quot;</span><span class="p">]</span>
                <span class="p">},</span>
                <span class="s2">&quot;labels&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">l</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span> <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="n">l</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">]}</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">issue</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;labels&quot;</span><span class="p">,</span> <span class="p">[])],</span>
                <span class="s2">&quot;comments&quot;</span><span class="p">:</span> <span class="n">issue</span><span class="p">[</span><span class="s2">&quot;comments&quot;</span><span class="p">],</span>
                <span class="s2">&quot;created_at&quot;</span><span class="p">:</span> <span class="n">issue</span><span class="p">[</span><span class="s2">&quot;created_at&quot;</span><span class="p">],</span>
                <span class="s2">&quot;updated_at&quot;</span><span class="p">:</span> <span class="n">issue</span><span class="p">[</span><span class="s2">&quot;updated_at&quot;</span><span class="p">],</span>
                <span class="s2">&quot;html_url&quot;</span><span class="p">:</span> <span class="n">issue</span><span class="p">[</span><span class="s2">&quot;html_url&quot;</span><span class="p">]</span>
            <span class="p">}</span>
            <span class="k">for</span> <span class="n">issue</span> <span class="ow">in</span> <span class="n">issues_data</span>
            <span class="k">if</span> <span class="s2">&quot;pull_request&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">issue</span>  <span class="c1"># Exclude PRs</span>
        <span class="p">]</span>
        
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">,</span>
            <span class="s2">&quot;total&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">issues</span><span class="p">),</span>
            <span class="s2">&quot;issues&quot;</span><span class="p">:</span> <span class="n">issues</span>
        <span class="p">}</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="s2">&quot;issues&quot;</span><span class="p">:</span> <span class="p">[]}</span></div>



<div class="viewcode-block" id="api_get_pulls">
<a class="viewcode-back" href="../main.html#main.api_get_pulls">[문서]</a>
<span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/api/github/pulls&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">api_get_pulls</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span> <span class="n">owner</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">repo</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;open&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get pull requests for a GitHub repository.</span>

<span class="sd">    Fetches pull requests directly from GitHub API (no clone required).</span>

<span class="sd">    :param request: FastAPI request object (contains auth token)</span>
<span class="sd">    :type request: Request</span>
<span class="sd">    :param owner: Repository owner (username or organization)</span>
<span class="sd">    :type owner: str</span>
<span class="sd">    :param repo: Repository name</span>
<span class="sd">    :type repo: str</span>
<span class="sd">    :param state: PR state filter (&quot;open&quot;, &quot;closed&quot;, &quot;all&quot;)</span>
<span class="sd">    :type state: str</span>

<span class="sd">    :returns: Pull requests list</span>
<span class="sd">    :rtype: dict</span>

<span class="sd">    **Response Fields:**</span>

<span class="sd">    - ``status`` (str): &quot;success&quot; | &quot;error&quot;</span>
<span class="sd">    - ``total`` (int): Number of PRs returned</span>
<span class="sd">    - ``pulls`` (list): List of pull request objects</span>

<span class="sd">    **Pull Request Object Fields:**</span>

<span class="sd">    - ``id`` (int): PR ID</span>
<span class="sd">    - ``number`` (int): PR number</span>
<span class="sd">    - ``title`` (str): PR title</span>
<span class="sd">    - ``state`` (str): PR state (&quot;open&quot; | &quot;closed&quot; | &quot;merged&quot;)</span>
<span class="sd">    - ``user`` (dict): Author info (login, avatar_url)</span>
<span class="sd">    - ``head`` (dict): Source branch info (ref, sha)</span>
<span class="sd">    - ``base`` (dict): Target branch info (ref)</span>
<span class="sd">    - ``draft`` (bool): Whether PR is a draft</span>
<span class="sd">    - ``mergeable_state`` (str | None): Merge status</span>
<span class="sd">    - ``created_at`` (str): Creation timestamp (ISO 8601)</span>
<span class="sd">    - ``updated_at`` (str): Last update timestamp (ISO 8601)</span>
<span class="sd">    - ``html_url`` (str): GitHub web URL</span>

<span class="sd">    .. note::</span>
<span class="sd">        Requires Authorization header with valid GitHub token.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">token</span> <span class="o">=</span> <span class="n">get_token</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">token</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;No authorization token&quot;</span><span class="p">,</span> <span class="s2">&quot;pulls&quot;</span><span class="p">:</span> <span class="p">[]}</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="k">async</span> <span class="k">with</span> <span class="n">httpx</span><span class="o">.</span><span class="n">AsyncClient</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mf">10.0</span><span class="p">)</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;https://api.github.com/repos/</span><span class="si">{</span><span class="n">owner</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">repo</span><span class="si">}</span><span class="s2">/pulls&quot;</span><span class="p">,</span>
                <span class="n">headers</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Bearer </span><span class="si">{</span><span class="n">token</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Accept&quot;</span><span class="p">:</span> <span class="s2">&quot;application/vnd.github.v3+json&quot;</span>
                <span class="p">},</span>
                <span class="n">params</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;state&quot;</span><span class="p">:</span> <span class="n">state</span><span class="p">,</span>
                    <span class="s2">&quot;per_page&quot;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
                    <span class="s2">&quot;sort&quot;</span><span class="p">:</span> <span class="s2">&quot;updated&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;direction&quot;</span><span class="p">:</span> <span class="s2">&quot;desc&quot;</span>
                <span class="p">}</span>
            <span class="p">)</span>
        
        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Failed to fetch pull requests&quot;</span><span class="p">,</span> <span class="s2">&quot;pulls&quot;</span><span class="p">:</span> <span class="p">[]}</span>
        
        <span class="n">pulls_data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        
        <span class="n">pulls</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">pr</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span>
                <span class="s2">&quot;number&quot;</span><span class="p">:</span> <span class="n">pr</span><span class="p">[</span><span class="s2">&quot;number&quot;</span><span class="p">],</span>
                <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="n">pr</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">],</span>
                <span class="s2">&quot;state&quot;</span><span class="p">:</span> <span class="n">pr</span><span class="p">[</span><span class="s2">&quot;state&quot;</span><span class="p">],</span>
                <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;login&quot;</span><span class="p">:</span> <span class="n">pr</span><span class="p">[</span><span class="s2">&quot;user&quot;</span><span class="p">][</span><span class="s2">&quot;login&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;avatar_url&quot;</span><span class="p">:</span> <span class="n">pr</span><span class="p">[</span><span class="s2">&quot;user&quot;</span><span class="p">][</span><span class="s2">&quot;avatar_url&quot;</span><span class="p">]</span>
                <span class="p">},</span>
                <span class="s2">&quot;head&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;ref&quot;</span><span class="p">:</span> <span class="n">pr</span><span class="p">[</span><span class="s2">&quot;head&quot;</span><span class="p">][</span><span class="s2">&quot;ref&quot;</span><span class="p">],</span>       <span class="c1"># Source branch</span>
                    <span class="s2">&quot;sha&quot;</span><span class="p">:</span> <span class="n">pr</span><span class="p">[</span><span class="s2">&quot;head&quot;</span><span class="p">][</span><span class="s2">&quot;sha&quot;</span><span class="p">][:</span><span class="mi">7</span><span class="p">]</span>    <span class="c1"># Commit SHA (abbreviated)</span>
                <span class="p">},</span>
                <span class="s2">&quot;base&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;ref&quot;</span><span class="p">:</span> <span class="n">pr</span><span class="p">[</span><span class="s2">&quot;base&quot;</span><span class="p">][</span><span class="s2">&quot;ref&quot;</span><span class="p">]</span>        <span class="c1"># Target branch</span>
                <span class="p">},</span>
                <span class="s2">&quot;draft&quot;</span><span class="p">:</span> <span class="n">pr</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;draft&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
                <span class="s2">&quot;mergeable_state&quot;</span><span class="p">:</span> <span class="n">pr</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;mergeable_state&quot;</span><span class="p">),</span>
                <span class="s2">&quot;created_at&quot;</span><span class="p">:</span> <span class="n">pr</span><span class="p">[</span><span class="s2">&quot;created_at&quot;</span><span class="p">],</span>
                <span class="s2">&quot;updated_at&quot;</span><span class="p">:</span> <span class="n">pr</span><span class="p">[</span><span class="s2">&quot;updated_at&quot;</span><span class="p">],</span>
                <span class="s2">&quot;html_url&quot;</span><span class="p">:</span> <span class="n">pr</span><span class="p">[</span><span class="s2">&quot;html_url&quot;</span><span class="p">]</span>
            <span class="p">}</span>
            <span class="k">for</span> <span class="n">pr</span> <span class="ow">in</span> <span class="n">pulls_data</span>
        <span class="p">]</span>
        
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">,</span>
            <span class="s2">&quot;total&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">pulls</span><span class="p">),</span>
            <span class="s2">&quot;pulls&quot;</span><span class="p">:</span> <span class="n">pulls</span>
        <span class="p">}</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="s2">&quot;pulls&quot;</span><span class="p">:</span> <span class="p">[]}</span></div>



<span class="c1"># ==============================================================================</span>
<span class="c1"># Server Entrypoint (Direct Execution)</span>
<span class="c1"># ==============================================================================</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">uvicorn</span>
    <span class="c1"># Run in development mode (no auto-reload)</span>
    <span class="n">uvicorn</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s2">&quot;0.0.0.0&quot;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">3001</span><span class="p">)</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Gition.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>