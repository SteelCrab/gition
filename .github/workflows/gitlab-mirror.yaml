# ==============================================================================
# GitLab Mirror Workflow
# ==============================================================================
# ì„¤ëª…: GitHub ì €ì¥ì†Œë¥¼ GitLabìœ¼ë¡œ ë¯¸ëŸ¬ë§ (ë°±ì—… ë° ì´ì¤‘í™”)
#
# ë™ì‘ ì¡°ê±´:
#   - main ë¸Œëœì¹˜ì— pushë  ë•Œ ìë™ ì‹¤í–‰
#   - workflow_dispatchë¡œ ìˆ˜ë™ ì‹¤í–‰ ê°€ëŠ¥
#
# í•„ìš” ì‹œí¬ë¦¿:
#   - GITLAB_TOKEN: GitLab Personal Access Token (api, write_repository ê¶Œí•œ)
#   - GITLAB_USERNAME: GitLab ì‚¬ìš©ìëª…
#
# ì„¤ì • ë°©ë²•:
#   1. GitLabì—ì„œ Personal Access Token ìƒì„±
#   2. GitHub ì €ì¥ì†Œ Settings > Secretsì— ì¶”ê°€
#   3. GitLabì— ë™ì¼í•œ ì´ë¦„ì˜ ë¹ˆ ì €ì¥ì†Œ ìƒì„±
# ==============================================================================

name: Mirror to GitLab

on:
  # main ë¸Œëœì¹˜ì— pushë  ë•Œ ìë™ ì‹¤í–‰
  push:
    branches: [main]
  
  # ìˆ˜ë™ ì‹¤í–‰ ë²„íŠ¼ í™œì„±í™” (Actions íƒ­ì—ì„œ ì‹¤í–‰ ê°€ëŠ¥)
  workflow_dispatch:

jobs:
  mirror:
    name: ğŸ”„ Mirror to GitLab
    runs-on: ubuntu-latest
    
    steps:
      # Step 1: ì „ì²´ Git íˆìŠ¤í† ë¦¬ ì²´í¬ì•„ì›ƒ
      # - fetch-depth: 0 = ëª¨ë“  ì»¤ë°‹/íƒœê·¸ íˆìŠ¤í† ë¦¬ ê°€ì ¸ì˜¤ê¸°
      - name: ğŸ“¥ Checkout
        uses: actions/checkout@v6
        with:
          fetch-depth: 0

      # Step 2: GitLabìœ¼ë¡œ í‘¸ì‹œ
      # - remoteê°€ ì—†ìœ¼ë©´ ì¶”ê°€ (|| trueë¡œ ì—ëŸ¬ ë¬´ì‹œ)
      # - main ë¸Œëœì¹˜ì™€ ëª¨ë“  íƒœê·¸ë¥¼ force push
      - name: ğŸ”„ Push to GitLab
        run: |
          git remote add gitlab https://oauth2:${{ secrets.GITLAB_TOKEN }}@gitlab.com/${{ secrets.GITLAB_USERNAME }}/${{ github.event.repository.name }}.git || true
          git push gitlab main --force
          git push gitlab --tags --force
